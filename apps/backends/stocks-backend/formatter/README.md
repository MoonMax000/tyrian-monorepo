# Formatter Service

Сервис форматирования данных, часть проекта Financial Data Aggregator. Отвечает за маршрутизацию запросов к различным источникам данных и форматирование ответов.

## Основные функции

- Получение запросов от Core сервиса
- Маршрутизация запросов к соответствующим web-clients
- Кэширование ответов в Redis
- Форматирование данных для Core сервиса

## Структура приложения

```
formatter/
├── api/                    # API endpoints
│   ├── __init__.py
│   ├── get_block_data_view.py  # Основной endpoint для получения данных
│   └── healthcheck.py          # Endpoint проверки здоровья
├── services/               # Бизнес-логика
│   ├── __init__.py
│   ├── get_block.py           # Получение конфигурации блока
│   └── get_block_data.py      # Получение данных из источников
├── shared/                # Общие компоненты
│   ├── __init__.py
│   └── data_blocks.py         # Конфигурация блоков данных
├── routers/              # Роутеры FastAPI
│   ├── __init__.py
│   └── router.py
├── cache.py             # Работа с Redis кэшем
├── logger.py            # Конфигурация логирования
├── main.py              # Точка входа приложения
├── Dockerfile
└── requirements.txt
```

## Конфигурация

### Блоки данных
Конфигурация блоков данных находится в `shared/data_blocks.py`:
```python
{
    "financial-statements": {
        "us": {
            "source": "fmp",        # Сервис-источник
            "port": 8003,           # Порт сервиса
            "params": ["ticker"],   # Обязательные параметры
            "expiration_time": 60   # Время кэширования в секундах
        }
    }
}
```

### Логирование
- DEBUG: Детальная информация для отладки
- INFO: Общая информация о работе приложения
- WARNING: Предупреждения
- ERROR: Ошибки выполнения

## API Endpoints

### GET /api/v1/get-block/{block_slug}/{country_slug}/
Получение данных для указанного блока.

Параметры:
- block_slug: Идентификатор блока данных
- country_slug: Код страны (us/ru)
- query params: Дополнительные параметры (например, ticker)

## Зависимости

- FastAPI
- Redis (для кэширования)
- httpx (для HTTP запросов)

## Запуск

Сервис запускается как часть основного проекта через docker-compose:
```bash
docker-compose up formatter
```

В виртуальном окружении необходимо установить переменные окружения:
- REDIS_HOST
- REDIS_PORT

для подключения к кэшу.

## Разработка

### Добавление нового блока данных
1. Добавить конфигурацию в data_blocks.py
2. При необходимости реализовать специфичное форматирование в services/get_block_data.py

### Тестирование
